# Chapter 7. Machine Learning Models for Time Series Prediction (시계열 예측을 위한 머신러닝 모델)
- `머신러닝`
  - 인공지능(AI)의 하위 분야
  - 컴퓨터가 명시적으로 프로그래밍되지 않아도 `학습`하고 `예측`이나 **결정**을 내릴 수 있도록 하는 **알고리즘과 모델의 개발**에 초점을 맞춘다. ==> 따라서, 그래서 `학습`이라는 용어가 사용
  - 일반적으로 `대량의 데이터를 분석`하고 그 안에서 **패턴을 추출**함으로써 이루어진다.
## The Framework
- 프레임워크는 연구 전반의 과정을 조직화하는 중요한 요소(데이터 수집부터 성능 평가까지)
- 적절한 프레임워크를 갖추는 것이 중요한 이유 
  - 백테스트 전반에 **일관성을 보장**
  -  다양한 머신러닝 모델 간의 **비교**가 가능
- 프레임워크는 일반적으로 `다음과 같은 순서`로 진행
  1. **데이터 가져오기 및 전처리**
     - 예측 모델을 제대로 백테스트하고 평가하려면 충분한 양의 데이터를 가져와야 한다. 
  2. **학습-테스트 분할 수행**
     - 이과정은 데이터를 두 부분으로 나누는 것
       - 첫 번째 부분은 알고리즘을 학습시키는 데 사용(미래 값을 예측하기 위한 수학적 공식 추출)
       - 두 번째 부분은 알고리즘이 한 번도 본 적 없는 데이터에 대해 얼마나 잘 작동하는지를 테스트
  3. **알고리즘을 사용해 학습(피팅)하고 예측(테스트) 수행**
  4. **성능 평가 알고리즘 실행**
     - 모델이 과거 데이터를 얼마나 잘 예측했는지 이해하기 위해 평가를 수행

> **Note**  
> - 학습용 데이터셋은 **인샘플(in-sample)** 데이터 라고도 한다.
> - 테스트용 데이터셋은 **아웃샘플(out-of-sample)** 데이터 라고도 한다.

- `학습용(in-sample)` 데이터셋에서는 모델을 학습시켜 **예측 함수**(forecasting function)를 도출
- `테스트용(out-of-sample)` 데이터셋에서는 학습 데이터로 계산된 예측 함수를 적용해 그 **성능을 평가**

#### master_function.py
- 시계열 데이터를 전처리(변환), 네 개의 배열(또는 원한다면 데이터프레임)로 나눈다.
- **데이터를 나누기 전에 중요한 점**
  - 무엇을 예측할 것인지(종속 변수)
  - 무엇을 가지고 예측할 것인지(독립 변수)를 명확히 아는 것

- `배열 x_train` 
  - 예측하고자 하는 변수의 변동을 설명해주는 **인샘플 독립 변수 집합**
  - **예측을 위한 입력값 또는 설명 변수(predictors)**
- `배열 y_train`
  - 모델이 예측 함수를 학습할 수 있도록 돕는, **인샘플 종속 변수 집합**
  - **정답 데이터**
- `배열 x_test`
  - 모델의 성능을 평가하기 위해 사용하는 **아웃샘플 독립 변수 집합**
  - **모델이 한 번도 본 적 없는 데이터**에 대한 테스트 입력값
- `배열 y_test`
  - 모델이 예측해야 하는 실제 값들
  - 예측 결과와 비교할 **정답 값**

````text
master_function.py
> 최근 500개의 일별 EUR/USD 수익률이 현재 수익률에 대한 예측력
````
- 종속 변수 (예측값)
  - EUR/USD의 t+1 시점의 일간 수익률 (y 변수)
- 독립 변수 (입력값)
  - EUR/USD의 이전 500일간의 일간 수익률 (x 변수)

#### 더미 회귀 모델(dummy regression model)
- `더미 회귀`
  - 아주 간단한 규칙만을 사용하여 예측하는 비교용 머신러닝 알고리즘
  - 실제 예측 가치가 거의 없기 때문에 벤치마크(기준선)로만 사용
  - 더미 회귀의 `유용성`은, **만든 모델**이 이 모델보다 뛰어난지 여부를 확인하는 데 있다.
- 더미 회귀 과정
  1. 데이터를 가져온다.
  2. 데이터를 전처리하고 분할한다.
  3. 알고리즘을 학습시킨다. 
  4. 학습한 파라미터를 이용해 테스트 데이터에 대해 예측을 수행한다.  
     또한, 비교를 위해 학습 데이터에 대해서도 예측을 수행한다.
  5. 결과를 그래프로 나타내고 평가한다. 


p224~226 : mac 에서는 실행이 되지 않는다..

- 더미 회귀(dummy regression)는 다음 전략 중 하나를 인자로 받을 수 있다
  - `mean (평균)`
    - 항상 학습 데이터(y_train)의 평균을 예측
  - `median (중앙값)`
    - 항상 학습 데이터의 중앙값을 예측
  - `quantile (분위수)`
    - 분위수 매개변수와 함께 제공될 경우, 학습 데이터의 지정된 분위수를 예측
  - `constant (상수)`
    - 사용자가 제공한 일정한 값을 항상 예측

- 앞서 본 코드에서 선택된 전략은 **mean**
  - 더미 회귀 전략을 사용할 경우 모든 예측 값은 단순히 학습 데이터(y_train)의 평균이 됩니다.
  - 더미 회귀 한계
    - 머신러닝 모델이 아니라 **기준선**(benchmark)으로만 사용된다.(더미 회귀는 학습하지 않고 평균 같은 단순한 값만 예측하기 때문)


- 모델이 잘 작동하는지 어떻게 알 수 있을까
  - `성능 평가`는 트레이딩과 알고리즘 개발에서 매우 중요한 개념
  - `성능 평가`를 통해 올바른 모델을 선택하고 실제 환경에 적용
- **성능 평가** 방법 크게 두 가지
  - `모델 평가` (Model Evaluation)
    - 알고리즘이 **예측을 얼마나 잘하는지 평가**
  - `트레이딩 평가`(Trading Evaluation)
    - 그 알고리즘을 사용해서 실제 매매했을 때 **금융 성과를 평가**

#### 모델 평가에서 자주 쓰는 지표
- **정확도(Accuracy)**
  - 공식 : 정확도(Accuracy) = (정확하게 맞춘 예측 수) ÷ (전체 예측 수) × 100
    - 예를 들어, 작년에 100번의 예측을 했고 그중 73번이 맞았다면, 정확도는 73%
  - `상승` 또는 `하락` **방향을 예측**
  - 금융권에서는 정확도를 **히트 비율(hit ratio)** 이라고도 한다.
- **예측의 정확도**는 예측값(y_predicted)이 실제값(y_test)과 얼마나 가까운지로도 평가 ==> **손실 함수(loss function) 사용**
- **손실 함수**(loss function)
  - 정의 : 예측값과 실제값 사이의 차이를 수학적으로 계산하는 함수
  1. **평균 절대 오차**(Mean Absolute Error, MAE)
     - `가장 기본적인 손실 함수` 
     - `MAE`는 **예측값과 실제값의 절대 차이들의 평균을 계산**
       - ![img.png](images/img_22.png)  
       - MAE는 예측값과 실제값 사이의 평균적인 거리(절대값 차이)를 나타내며, **MAE 값이 작을수록 모델의 예측이 더 정확하다는 의미**
  2. **평균 제곱 오차**(Mean Squared Error, MSE)
     - `MSE`는 **예측값과 실제값의 차이를 제곱하여 평균한 값** ==> 회귀 문제에서 자주 사용
     - MAE와 마찬가지로, **MSE가 낮을수록 모델이 더 정확하다는 의미** ==> but MSE는 오차를 제곱하기 때문에, **큰 오차에 더 민감**하게 반응한다.
     - 하지만, MSE는 제곱된 단위를 가지기 때문에 해석이 직관적이지 않을 수 있음. ==> 이를 해결 위해, RMSE(Root Mean Squared Error, 평균 제곱근 오차) 나옴
     - `RMSE`는 **MSE의 제곱근을 취함**으로써, 원래 목표 변수와 같은 단위로 되돌려 준다.
       - `RMSE`는 **예측값이 실제값으로부터 얼마나 떨어져 있는지를 측정** ==> 표준편차(standard deviation) 와 동등한 개념

> Note
> - 데이터에 극단적인 값이 포함되어 있거나, 오차의 절대적인 크기가 중요할 때는 **MAE를 사용하는 것이 적절**
> - 모델의 성능을 더 민감하게 개선하고 싶을 때 주로 **MSE를 사용하는 것이 적절**
>   - 모델의 정밀한 조정(tuning)을 원할 때는 MSE가 더 유용

P 231

## 